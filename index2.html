<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <!-- Created: 2026-01-07T23:15  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ˜Ÿç›¤åˆ†æç³»çµ± Web ç‰ˆ</title>
  <link rel="stylesheet" href="style.css" />
  <!-- è¼‰å…¥ Swiss Ephemeris å‡½å¼åº« -->
  <script src="https://cdn.jsdelivr.net/npm/sweph@2.10.0/dist/sweph.min.js?v=13"></script>
  <script>
    // ğŸŒŸ é˜²å‘†ï¼šå¦‚æœ sweph æœªæˆåŠŸè¼‰å…¥å°±è‡ªå‹•é‡è©¦å…©æ¬¡
    (function ensureSwephLoaded(retries = 0) {
      if (typeof window.sweph === "undefined") {
        if (retries < 2) {
          console.warn(`âš ï¸ sweph å°šæœªè¼‰å…¥ï¼Œé‡è©¦ç¬¬ ${retries + 1} æ¬¡...`);
          setTimeout(() => ensureSwephLoaded(retries + 1), 1200);
          return;
        } else {
          alert("âš ï¸ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° sweph æ¨¡çµ„ã€‚è«‹é‡æ–°æ•´ç†æˆ–æª¢æŸ¥ç¶²è·¯ã€‚");
        }
      } else {
        console.log("âœ… sweph è¼‰å…¥æˆåŠŸï¼");
      }
    })();
  </script>
</head>

<body>
  <div class="container">
    <h1>ğŸŒ æ˜Ÿç›¤åˆ†æç³»çµ± Web ç‰ˆ</h1>

    <form id="astroForm">
      <label for="birthDate">å‡ºç”Ÿæ—¥æœŸï¼š</label>
      <input type="date" id="birthDate" required />

      <label for="birthTime">å‡ºç”Ÿæ™‚é–“ï¼š</label>
      <input type="time" id="birthTime" required />

      <label for="birthPlace">åœ°é»ï¼š</label>
      <input type="text" id="birthPlace" placeholder="ä¾‹ï¼šé¦™æ¸¯" />

      <button type="submit">ç”¢ç”Ÿå ±å‘Š</button>
    </form>

    <pre id="report"></pre>
  </div>

  <script>
    // ğŸŒ  é˜²å‘†æª¢æŸ¥ï¼šç¢ºä¿ sweph è¼‰å…¥æˆåŠŸ
    if (typeof sweph === "undefined") {
      throw new Error("sweph module not defined");
    }

    async function generateReport(date, time, place) {
      try {
        const [yyyy, mm, dd] = date.split("-").map(Number);
        const [hh, mi] = time.split(":").map(Number);

        const jd = sweph.swe_julday(yyyy, mm, dd, hh + mi / 60, sweph.SE_GREG_CAL);
        let output = `ğŸ“… æ—¥æœŸæ™‚é–“ï¼š${yyyy}/${mm}/${dd}  ${hh}:${mi}\nğŸ“ åœ°é»ï¼š${place}\n\nğŸª è¡Œæ˜Ÿä½ç½®ï¼ˆç¤ºä¾‹ï¼‰:\n`;

        const planets = [
          "â˜‰ å¤ªé™½", "â˜½ æœˆäº®", "â˜¿ æ°´æ˜Ÿ",
          "â™€ é‡‘æ˜Ÿ", "â™‚ ç«æ˜Ÿ", "â™ƒ æœ¨æ˜Ÿ",
          "â™„ åœŸæ˜Ÿ", "â™… å¤©ç‹æ˜Ÿ", "â™† æµ·ç‹æ˜Ÿ", "â™‡ å†¥ç‹æ˜Ÿ"
        ];

        for (let i = 0; i <= 9; i++) {
          const result = sweph.swe_calc_ut(jd, i, sweph.SEFLG_SWIEPH);
          const lon = result.x[0].toFixed(2);
          output += `${planets[i]}ï¼š${lon}Â°\n`;
        }

        return output;
      } catch (err) {
        return "âŒ éŒ¯èª¤ï¼š" + err.message;
      }
    }

    document.getElementById("astroForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const date = document.getElementById("birthDate").value;
      const time = document.getElementById("birthTime").value;
      const place = document.getElementById("birthPlace").value || "(æœªçŸ¥)";

      document.getElementById("report").textContent = "ç”Ÿæˆä¸­ï¼Œè«‹ç¨å€™...";
      const text = await generateReport(date, time, place);
      document.getElementById("report").textContent = text;
    });
  </script>
</body>
</html>